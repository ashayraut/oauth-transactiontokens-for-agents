name: "Update Generated Files"

on: workflow_dispatch

jobs:
  build:
    name: "Update Files"
    runs-on: ubuntu-latest
    permissions:
      contents: write # Essential for the push to work
    steps:
    - name: "Checkout"
      uses: actions/checkout@v5 # Use v5 or the latest stable
      with:
        fetch-depth: 0 # FETCH FULL HISTORY to satisfy the build script's check
        
    - name: "Update Generated Files"
      uses: martinthomson/i-d-template@v1
      with:
        make: update-files
        token: ${{ github.token }}
        
    - name: "Commit and Push Update"
      run: |
        # 1. Configure the Git user (required for actions to push)
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        
        # 2. Add all changes created by the i-d-template action
        git add .
        
        # 3. Check if there are actual changes (to prevent a failed run on an empty commit)
        if git diff --staged --quiet; then
          echo "No files were updated by the template action. Skipping commit and push."
        else
          # 4. Commit the changes
          git commit -m "ðŸ¤– Automatic file update (README, .gitignore, etc.)"
          
          # 5. Push the commit
          git push
        fi
